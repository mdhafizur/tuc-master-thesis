[
  {
    "id": "sql-injection-1",
    "name": "SQL Injection - String Concatenation",
    "code": "function getUserData(userId) {\n    const query = \"SELECT * FROM users WHERE id = \" + userId;\n    return db.query(query);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "SQL Injection",
        "cwe": "CWE-89",
        "severity": "high",
        "description": "User input concatenated directly into SQL query"
      }
    ],
    "expectedFix": "Use parameterized queries or prepared statements"
  },
  {
    "id": "xss-1",
    "name": "Cross-Site Scripting - innerHTML",
    "code": "function displayMessage(userInput) {\n    document.getElementById('output').innerHTML = userInput;\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Cross-Site Scripting (XSS)",
        "cwe": "CWE-79",
        "severity": "high",
        "description": "Unsanitized user input rendered as HTML"
      }
    ],
    "expectedFix": "Use textContent instead of innerHTML or sanitize input"
  },
  {
    "id": "command-injection-1",
    "name": "Command Injection - exec with user input",
    "code": "const exec = require('child_process').exec;\nfunction executeCommand(userCommand) {\n    exec('ls -la ' + userCommand, (error, stdout) => {\n        console.log(stdout);\n    });\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Command Injection",
        "cwe": "CWE-78",
        "severity": "critical",
        "description": "User input passed to shell command execution"
      }
    ],
    "expectedFix": "Use execFile with array arguments or validate/sanitize input"
  },
  {
    "id": "path-traversal-1",
    "name": "Path Traversal - Unsanitized file path",
    "code": "const fs = require('fs');\nfunction readUserFile(filename) {\n    const filePath = './uploads/' + filename;\n    return fs.readFileSync(filePath, 'utf8');\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Path Traversal",
        "cwe": "CWE-22",
        "severity": "high",
        "description": "User-controlled filename allows directory traversal"
      }
    ],
    "expectedFix": "Validate filename, use path.basename(), or whitelist allowed files"
  },
  {
    "id": "insecure-crypto-1",
    "name": "Weak Cryptography - MD5 for passwords",
    "code": "const crypto = require('crypto');\nfunction hashPassword(password) {\n    return crypto.createHash('md5').update(password).digest('hex');\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Weak Cryptography",
        "cwe": "CWE-327",
        "severity": "high",
        "description": "MD5 is cryptographically broken for password hashing"
      }
    ],
    "expectedFix": "Use bcrypt, argon2, or scrypt for password hashing"
  },
  {
    "id": "nosql-injection-1",
    "name": "NoSQL Injection - MongoDB",
    "code": "function findUser(username) {\n    return db.collection('users').findOne({ username: username });\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "NoSQL Injection",
        "cwe": "CWE-943",
        "severity": "high",
        "description": "Unsanitized input in MongoDB query can allow object injection"
      }
    ],
    "expectedFix": "Validate input type, sanitize objects, use query builders"
  },
  {
    "id": "hardcoded-secret-1",
    "name": "Hardcoded Credentials",
    "code": "const config = {\n    apiKey: 'sk-1234567890abcdef',\n    dbPassword: 'SuperSecret123!',\n    jwtSecret: 'my-jwt-secret-key'\n};",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Hardcoded Credentials",
        "cwe": "CWE-798",
        "severity": "critical",
        "description": "Secrets hardcoded in source code"
      }
    ],
    "expectedFix": "Use environment variables or secret management service"
  },
  {
    "id": "xxe-1",
    "name": "XML External Entity (XXE)",
    "code": "const libxml = require('libxmljs');\nfunction parseXML(userXML) {\n    return libxml.parseXml(userXML);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "XML External Entity (XXE)",
        "cwe": "CWE-611",
        "severity": "high",
        "description": "XML parser allows external entities by default"
      }
    ],
    "expectedFix": "Disable external entity processing in XML parser"
  },
  {
    "id": "insecure-random-1",
    "name": "Insecure Random Number Generation",
    "code": "function generateToken() {\n    return Math.random().toString(36).substring(2);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Insecure Randomness",
        "cwe": "CWE-338",
        "severity": "medium",
        "description": "Math.random() is not cryptographically secure"
      }
    ],
    "expectedFix": "Use crypto.randomBytes() for security-sensitive tokens"
  },
  {
    "id": "regex-dos-1",
    "name": "Regular Expression Denial of Service (ReDoS)",
    "code": "function validateEmail(email) {\n    const regex = /^([a-zA-Z0-9]+)*@([a-zA-Z0-9]+)*\\.com$/;\n    return regex.test(email);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Regular Expression DoS",
        "cwe": "CWE-1333",
        "severity": "medium",
        "description": "Nested quantifiers can cause catastrophic backtracking"
      }
    ],
    "expectedFix": "Simplify regex pattern or use regex timeout"
  },
  {
    "id": "jwt-no-verify-1",
    "name": "JWT Verification Disabled",
    "code": "const jwt = require('jsonwebtoken');\nfunction decodeToken(token) {\n    return jwt.decode(token, { complete: true });\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Broken Authentication",
        "cwe": "CWE-287",
        "severity": "critical",
        "description": "JWT decoded without signature verification"
      }
    ],
    "expectedFix": "Use jwt.verify() with secret key instead of decode()"
  },
  {
    "id": "insecure-deserialization-1",
    "name": "Insecure Deserialization",
    "code": "function processUserData(serializedData) {\n    return eval('(' + serializedData + ')');\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Code Injection / Insecure Deserialization",
        "cwe": "CWE-502",
        "severity": "critical",
        "description": "eval() on user data allows arbitrary code execution"
      }
    ],
    "expectedFix": "Use JSON.parse() instead of eval()"
  },
  {
    "id": "open-redirect-1",
    "name": "Open Redirect",
    "code": "function redirect(req, res) {\n    const redirectUrl = req.query.url;\n    res.redirect(redirectUrl);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Open Redirect",
        "cwe": "CWE-601",
        "severity": "medium",
        "description": "Unvalidated redirect to user-controlled URL"
      }
    ],
    "expectedFix": "Validate redirect URL against whitelist or use relative paths only"
  },
  {
    "id": "csrf-no-protection-1",
    "name": "Missing CSRF Protection",
    "code": "app.post('/transfer-money', (req, res) => {\n    const { to, amount } = req.body;\n    transferMoney(req.user.id, to, amount);\n    res.send('Transfer complete');\n});",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Cross-Site Request Forgery (CSRF)",
        "cwe": "CWE-352",
        "severity": "high",
        "description": "State-changing operation without CSRF token validation"
      }
    ],
    "expectedFix": "Implement CSRF token validation or use SameSite cookies"
  },
  {
    "id": "sensitive-data-exposure-1",
    "name": "Sensitive Data in Logs",
    "code": "function loginUser(username, password) {\n    console.log('Login attempt:', { username, password });\n    return authenticateUser(username, password);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Sensitive Data Exposure",
        "cwe": "CWE-532",
        "severity": "medium",
        "description": "Password logged in plaintext"
      }
    ],
    "expectedFix": "Never log sensitive data like passwords"
  },
  {
    "id": "prototype-pollution-1",
    "name": "Prototype Pollution",
    "code": "function merge(target, source) {\n    for (let key in source) {\n        target[key] = source[key];\n    }\n    return target;\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Prototype Pollution",
        "cwe": "CWE-1321",
        "severity": "high",
        "description": "Unsafe object merge can pollute Object prototype"
      }
    ],
    "expectedFix": "Check hasOwnProperty and avoid __proto__ assignment"
  },
  {
    "id": "race-condition-1",
    "name": "Time-of-Check Time-of-Use (TOCTOU)",
    "code": "async function processFile(filename) {\n    if (await fs.exists(filename)) {\n        const data = await fs.readFile(filename);\n        return processData(data);\n    }\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Race Condition",
        "cwe": "CWE-367",
        "severity": "low",
        "description": "File existence check and read are not atomic"
      }
    ],
    "expectedFix": "Directly attempt to read file and handle errors"
  },
  {
    "id": "unsafe-reflection-1",
    "name": "Unsafe Reflection",
    "code": "function callMethod(obj, methodName) {\n    return obj[methodName]();\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Unsafe Reflection",
        "cwe": "CWE-470",
        "severity": "medium",
        "description": "User-controlled method name allows calling arbitrary methods"
      }
    ],
    "expectedFix": "Whitelist allowed method names"
  },
  {
    "id": "secure-code-1",
    "name": "Secure Code - Parameterized Query (No Vulnerability)",
    "code": "async function getUserData(userId) {\n    const query = 'SELECT * FROM users WHERE id = ?';\n    return await db.query(query, [userId]);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-2",
    "name": "Secure Code - textContent Usage (No Vulnerability)",
    "code": "function displayMessage(userInput) {\n    const element = document.getElementById('output');\n    element.textContent = userInput;\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-3",
    "name": "Secure Code - execFile with Array Arguments (No Vulnerability)",
    "code": "const { execFile } = require('child_process');\nfunction listDir(dirName) {\n    const sanitized = dirName.replace(/[^a-zA-Z0-9_\\-\\/]/g, '');\n    execFile('ls', ['-la', sanitized], (error, stdout) => {\n        console.log(stdout);\n    });\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-4",
    "name": "Secure Code - bcrypt Password Hashing (No Vulnerability)",
    "code": "const bcrypt = require('bcrypt');\nasync function hashPassword(password) {\n    const saltRounds = 12;\n    return await bcrypt.hash(password, saltRounds);\n}\nasync function verifyPassword(password, hash) {\n    return await bcrypt.compare(password, hash);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-5",
    "name": "Secure Code - Path Traversal Prevention (No Vulnerability)",
    "code": "const path = require('path');\nconst fs = require('fs');\nfunction readUserFile(filename) {\n    const uploadsDir = path.resolve('./uploads');\n    const filePath = path.resolve(path.join(uploadsDir, filename));\n    if (!filePath.startsWith(uploadsDir)) {\n        throw new Error('Access denied: path traversal attempt');\n    }\n    return fs.readFileSync(filePath, 'utf8');\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-6",
    "name": "Secure Code - CSRF Token Validation (No Vulnerability)",
    "code": "const crypto = require('crypto');\nfunction generateCsrfToken(session) {\n    const token = crypto.randomBytes(32).toString('hex');\n    session.csrfToken = token;\n    return token;\n}\nfunction validateCsrfToken(req) {\n    const token = req.headers['x-csrf-token'];\n    return token && token === req.session.csrfToken;\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-7",
    "name": "Secure Code - Input Validation with Joi (No Vulnerability)",
    "code": "const Joi = require('joi');\nconst schema = Joi.object({\n    username: Joi.string().alphanum().min(3).max(30).required(),\n    email: Joi.string().email().required(),\n    age: Joi.number().integer().min(0).max(120)\n});\nfunction validateInput(data) {\n    const { error, value } = schema.validate(data);\n    if (error) throw new Error(`Validation failed: ${error.message}`);\n    return value;\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-8",
    "name": "Secure Code - Helmet Security Headers (No Vulnerability)",
    "code": "const express = require('express');\nconst helmet = require('helmet');\nconst app = express();\napp.use(helmet());\napp.use(helmet.contentSecurityPolicy({\n    directives: {\n        defaultSrc: [\"'self'\"],\n        scriptSrc: [\"'self'\"],\n        styleSrc: [\"'self'\"]\n    }\n}));",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-9",
    "name": "Secure Code - Rate Limiting (No Vulnerability)",
    "code": "const rateLimit = require('express-rate-limit');\nconst limiter = rateLimit({\n    windowMs: 15 * 60 * 1000,\n    max: 100,\n    standardHeaders: true,\n    legacyHeaders: false,\n    message: 'Too many requests, please try again later.'\n});\napp.use('/api/', limiter);",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-10",
    "name": "Secure Code - JWT with Proper Verification (No Vulnerability)",
    "code": "const jwt = require('jsonwebtoken');\nconst SECRET = process.env.JWT_SECRET;\nfunction verifyToken(token) {\n    try {\n        return jwt.verify(token, SECRET, { algorithms: ['HS256'] });\n    } catch (err) {\n        throw new Error('Invalid token');\n    }\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-11",
    "name": "Secure Code - DOMPurify Sanitization (No Vulnerability)",
    "code": "const DOMPurify = require('dompurify');\nfunction renderUserContent(htmlInput) {\n    const clean = DOMPurify.sanitize(htmlInput, { ALLOWED_TAGS: ['b', 'i', 'em', 'strong'] });\n    document.getElementById('content').innerHTML = clean;\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-12",
    "name": "Secure Code - Prototype Pollution Prevention (No Vulnerability)",
    "code": "function safeMerge(target, source) {\n    for (const key of Object.keys(source)) {\n        if (key === '__proto__' || key === 'constructor' || key === 'prototype') {\n            continue;\n        }\n        target[key] = source[key];\n    }\n    return target;\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-13",
    "name": "Secure Code - Crypto Random Values (No Vulnerability)",
    "code": "const crypto = require('crypto');\nfunction generateSecureToken(length = 32) {\n    return crypto.randomBytes(length).toString('hex');\n}\nfunction generateSecureOTP() {\n    return crypto.randomInt(100000, 999999);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-14",
    "name": "Secure Code - Environment Variable Config (No Vulnerability)",
    "code": "function getDbConfig() {\n    return {\n        host: process.env.DB_HOST || 'localhost',\n        port: parseInt(process.env.DB_PORT || '5432', 10),\n        database: process.env.DB_NAME,\n        user: process.env.DB_USER,\n        password: process.env.DB_PASSWORD,\n        ssl: process.env.DB_SSL === 'true'\n    };\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-15",
    "name": "Secure Code - Safe Redirect with Allowlist (No Vulnerability)",
    "code": "const ALLOWED_REDIRECTS = ['/dashboard', '/profile', '/settings'];\nfunction safeRedirect(req, res) {\n    const target = req.query.redirect;\n    if (ALLOWED_REDIRECTS.includes(target)) {\n        return res.redirect(target);\n    }\n    return res.redirect('/dashboard');\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  }
]
