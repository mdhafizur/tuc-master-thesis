[
  {
    "id": "server-side-template-injection-1",
    "name": "Server-Side Template Injection (SSTI)",
    "code": "const ejs = require('ejs');\nfunction renderTemplate(userInput) {\n    const template = '<h1>' + userInput + '</h1>';\n    return ejs.render(template);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Server-Side Template Injection",
        "cwe": "CWE-94",
        "severity": "critical",
        "description": "User input embedded in template without sanitization"
      }
    ],
    "expectedFix": "Use parameterized templates or escape user input"
  },
  {
    "id": "ldap-injection-1",
    "name": "LDAP Injection",
    "code": "const ldap = require('ldapjs');\nfunction searchUser(username) {\n    const filter = '(&(uid=' + username + ')(objectClass=person))';\n    return client.search('ou=users,dc=example,dc=com', { filter });\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "LDAP Injection",
        "cwe": "CWE-90",
        "severity": "high",
        "description": "LDAP query constructed with unsanitized user input"
      }
    ],
    "expectedFix": "Escape LDAP special characters or use parameterized queries"
  },
  {
    "id": "zip-slip-1",
    "name": "Zip Slip - Path Traversal in Archives",
    "code": "const AdmZip = require('adm-zip');\nfunction extractZip(zipPath) {\n    const zip = new AdmZip(zipPath);\n    const entries = zip.getEntries();\n    entries.forEach(entry => {\n        zip.extractEntryTo(entry, './uploads/', false, true);\n    });\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Path Traversal (Zip Slip)",
        "cwe": "CWE-22",
        "severity": "high",
        "description": "Zip entry names not validated for path traversal"
      }
    ],
    "expectedFix": "Validate entry paths and prevent directory traversal"
  },
  {
    "id": "mass-assignment-1",
    "name": "Mass Assignment Vulnerability",
    "code": "function updateUser(req, res) {\n    const userId = req.params.id;\n    const updates = req.body;\n    User.findByIdAndUpdate(userId, updates);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Mass Assignment",
        "cwe": "CWE-915",
        "severity": "high",
        "description": "All request body fields directly assigned without whitelisting"
      }
    ],
    "expectedFix": "Whitelist allowed fields or use explicit field mapping"
  },
  {
    "id": "timing-attack-1",
    "name": "Timing Attack on String Comparison",
    "code": "function verifyApiKey(providedKey, actualKey) {\n    if (providedKey === actualKey) {\n        return true;\n    }\n    return false;\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Timing Attack",
        "cwe": "CWE-208",
        "severity": "medium",
        "description": "String comparison vulnerable to timing attacks"
      }
    ],
    "expectedFix": "Use constant-time comparison (crypto.timingSafeEqual)"
  },
  {
    "id": "insecure-cors-1",
    "name": "Insecure CORS Configuration",
    "code": "app.use((req, res, next) => {\n    res.header('Access-Control-Allow-Origin', req.headers.origin);\n    res.header('Access-Control-Allow-Credentials', 'true');\n    next();\n});",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Insecure CORS",
        "cwe": "CWE-942",
        "severity": "high",
        "description": "CORS allows any origin with credentials"
      }
    ],
    "expectedFix": "Whitelist specific origins or don't allow credentials with wildcard"
  },
  {
    "id": "jwt-algorithm-confusion-1",
    "name": "JWT Algorithm Confusion",
    "code": "const jwt = require('jsonwebtoken');\nfunction verifyToken(token, publicKey) {\n    return jwt.verify(token, publicKey);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "JWT Algorithm Confusion",
        "cwe": "CWE-327",
        "severity": "critical",
        "description": "JWT verification without specifying algorithm allows 'none' or 'HS256'"
      }
    ],
    "expectedFix": "Specify algorithm explicitly: jwt.verify(token, key, { algorithms: ['RS256'] })"
  },
  {
    "id": "clickjacking-1",
    "name": "Missing Clickjacking Protection",
    "code": "const express = require('express');\nconst app = express();\napp.get('/', (req, res) => {\n    res.send('<h1>Welcome</h1>');\n});",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Clickjacking",
        "cwe": "CWE-1021",
        "severity": "medium",
        "description": "No X-Frame-Options or CSP frame-ancestors header"
      }
    ],
    "expectedFix": "Add helmet middleware or set X-Frame-Options: DENY"
  },
  {
    "id": "session-fixation-1",
    "name": "Session Fixation",
    "code": "function login(req, res) {\n    if (authenticate(req.body.username, req.body.password)) {\n        req.session.user = req.body.username;\n        res.send('Logged in');\n    }\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Session Fixation",
        "cwe": "CWE-384",
        "severity": "high",
        "description": "Session not regenerated after authentication"
      }
    ],
    "expectedFix": "Regenerate session ID: req.session.regenerate()"
  },
  {
    "id": "buffer-overflow-1",
    "name": "Buffer Overflow Risk",
    "code": "function processData(data) {\n    const buffer = Buffer.alloc(10);\n    buffer.write(data);\n    return buffer.toString();\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Buffer Overflow",
        "cwe": "CWE-120",
        "severity": "high",
        "description": "Writing to fixed-size buffer without length validation"
      }
    ],
    "expectedFix": "Validate data length or use Buffer.from with truncation"
  },
  {
    "id": "http-parameter-pollution-1",
    "name": "HTTP Parameter Pollution",
    "code": "function getUser(req, res) {\n    const userId = req.query.id;\n    db.query('SELECT * FROM users WHERE id = ?', [userId]);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "HTTP Parameter Pollution",
        "cwe": "CWE-235",
        "severity": "medium",
        "description": "No validation if 'id' is array (multiple values)"
      }
    ],
    "expectedFix": "Validate parameter is string, not array"
  },
  {
    "id": "xml-bomb-1",
    "name": "XML Bomb (Billion Laughs)",
    "code": "const libxml = require('libxmljs');\nfunction parseXML(xmlString) {\n    return libxml.parseXml(xmlString);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "XML Entity Expansion",
        "cwe": "CWE-776",
        "severity": "high",
        "description": "XML parser vulnerable to entity expansion attacks"
      }
    ],
    "expectedFix": "Disable entity expansion and set limits"
  },
  {
    "id": "authentication-bypass-1",
    "name": "Authentication Bypass via Type Confusion",
    "code": "function checkAdmin(user) {\n    if (user.role == 'admin') {\n        return true;\n    }\n    return false;\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Type Confusion",
        "cwe": "CWE-843",
        "severity": "high",
        "description": "Loose equality (==) allows type coercion bypass"
      }
    ],
    "expectedFix": "Use strict equality (===) to prevent type coercion"
  },
  {
    "id": "email-injection-1",
    "name": "Email Header Injection",
    "code": "const nodemailer = require('nodemailer');\nfunction sendEmail(to, subject, body) {\n    const mailOptions = {\n        from: 'noreply@example.com',\n        to: to,\n        subject: subject,\n        text: body\n    };\n    transporter.sendMail(mailOptions);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Email Injection",
        "cwe": "CWE-93",
        "severity": "high",
        "description": "Email headers (to, subject) not sanitized for CRLF injection"
      }
    ],
    "expectedFix": "Validate and sanitize email headers, remove CRLF characters"
  },
  {
    "id": "insecure-websocket-1",
    "name": "Insecure WebSocket Connection",
    "code": "const ws = new WebSocket('ws://example.com/socket');\nws.onmessage = (event) => {\n    eval(event.data);\n};",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Insecure WebSocket + Code Injection",
        "cwe": "CWE-94",
        "severity": "critical",
        "description": "Unencrypted WebSocket with eval on messages"
      }
    ],
    "expectedFix": "Use wss:// protocol and parse JSON instead of eval"
  },
  {
    "id": "server-side-request-forgery-1",
    "name": "Server-Side Request Forgery (SSRF)",
    "code": "const axios = require('axios');\nfunction fetchUrl(url) {\n    return axios.get(url);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "SSRF",
        "cwe": "CWE-918",
        "severity": "high",
        "description": "Unvalidated URL allows requests to internal resources"
      }
    ],
    "expectedFix": "Validate URL against whitelist, block private IP ranges"
  },
  {
    "id": "graphql-introspection-1",
    "name": "GraphQL Introspection Enabled in Production",
    "code": "const { ApolloServer } = require('apollo-server');\nconst server = new ApolloServer({\n    typeDefs,\n    resolvers,\n    introspection: true\n});",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Information Disclosure",
        "cwe": "CWE-200",
        "severity": "medium",
        "description": "GraphQL introspection reveals schema in production"
      }
    ],
    "expectedFix": "Disable introspection in production: introspection: false"
  },
  {
    "id": "weak-session-id-1",
    "name": "Weak Session ID Generation",
    "code": "function generateSessionId() {\n    return Date.now().toString() + Math.floor(Math.random() * 10000);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Weak Session ID",
        "cwe": "CWE-330",
        "severity": "high",
        "description": "Predictable session ID using timestamp and weak randomness"
      }
    ],
    "expectedFix": "Use crypto.randomBytes for secure session IDs"
  },
  {
    "id": "directory-listing-1",
    "name": "Directory Listing Enabled",
    "code": "const express = require('express');\nconst app = express();\napp.use(express.static('public', { dotfiles: 'allow' }));",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Information Disclosure",
        "cwe": "CWE-548",
        "severity": "medium",
        "description": "Static file serving allows dotfiles and directory listing"
      }
    ],
    "expectedFix": "Set dotfiles: 'ignore' and disable directory indexes"
  },
  {
    "id": "unvalidated-file-upload-1",
    "name": "Unvalidated File Upload",
    "code": "const multer = require('multer');\nconst upload = multer({ dest: 'uploads/' });\napp.post('/upload', upload.single('file'), (req, res) => {\n    res.send('File uploaded');\n});",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Unrestricted File Upload",
        "cwe": "CWE-434",
        "severity": "critical",
        "description": "No file type or size validation"
      }
    ],
    "expectedFix": "Validate file type, size, and use fileFilter in multer"
  },
  {
    "id": "mongodb-operator-injection-1",
    "name": "MongoDB Operator Injection",
    "code": "function findUser(username, password) {\n    return db.collection('users').findOne({\n        username: username,\n        password: password\n    });\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "NoSQL Injection (MongoDB)",
        "cwe": "CWE-943",
        "severity": "critical",
        "description": "MongoDB query with object parameters allows operator injection"
      }
    ],
    "expectedFix": "Validate input types or use parameterized queries"
  },
  {
    "id": "insufficient-entropy-1",
    "name": "Insufficient Entropy for Token",
    "code": "function generateResetToken() {\n    return Math.random().toString(36).substr(2, 9);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Insufficient Entropy",
        "cwe": "CWE-331",
        "severity": "high",
        "description": "Password reset token has insufficient randomness"
      }
    ],
    "expectedFix": "Use crypto.randomBytes(32).toString('hex')"
  },
  {
    "id": "cache-poisoning-1",
    "name": "Cache Poisoning via Unkeyed Headers",
    "code": "app.use((req, res, next) => {\n    res.set('Cache-Control', 'public, max-age=3600');\n    res.send(renderPage(req.headers['x-custom-header']));\n});",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Cache Poisoning",
        "cwe": "CWE-444",
        "severity": "medium",
        "description": "Response varies by unkeyed header but cached publicly"
      }
    ],
    "expectedFix": "Include varying headers in cache key or use Vary header"
  },
  {
    "id": "denial-of-service-json-1",
    "name": "JSON Parsing DoS",
    "code": "app.use(express.json({ limit: '50mb' }));\napp.post('/data', (req, res) => {\n    processData(req.body);\n});",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Denial of Service",
        "cwe": "CWE-400",
        "severity": "high",
        "description": "Large JSON payload limit can cause memory exhaustion"
      }
    ],
    "expectedFix": "Set reasonable limits (e.g., 100kb) and implement rate limiting"
  },
  {
    "id": "api-key-exposure-1",
    "name": "API Key in Client-Side Code",
    "code": "const API_KEY = 'sk_live_1234567890abcdef';\nfetch('https://api.example.com/data', {\n    headers: { 'Authorization': `Bearer ${API_KEY}` }\n});",
    "language": "javascript",
    "expectedVulnerabilities": [
      {
        "type": "Hardcoded Credentials in Client Code",
        "cwe": "CWE-798",
        "severity": "critical",
        "description": "API key hardcoded in client-side JavaScript"
      }
    ],
    "expectedFix": "API calls should go through backend proxy, never expose keys in frontend"
  },
  {
    "id": "secure-code-3",
    "name": "Secure Code - Proper Input Validation (No Vulnerability)",
    "code": "function processUserId(userId) {\n    if (typeof userId !== 'string' || !/^\\d+$/.test(userId)) {\n        throw new Error('Invalid user ID');\n    }\n    return db.query('SELECT * FROM users WHERE id = ?', [parseInt(userId, 10)]);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-4",
    "name": "Secure Code - Proper CORS Configuration (No Vulnerability)",
    "code": "const allowedOrigins = ['https://example.com', 'https://app.example.com'];\napp.use((req, res, next) => {\n    const origin = req.headers.origin;\n    if (allowedOrigins.includes(origin)) {\n        res.header('Access-Control-Allow-Origin', origin);\n    }\n    next();\n});",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  },
  {
    "id": "secure-code-5",
    "name": "Secure Code - Constant-Time Comparison (No Vulnerability)",
    "code": "const crypto = require('crypto');\nfunction verifyToken(provided, actual) {\n    const providedBuffer = Buffer.from(provided);\n    const actualBuffer = Buffer.from(actual);\n    if (providedBuffer.length !== actualBuffer.length) return false;\n    return crypto.timingSafeEqual(providedBuffer, actualBuffer);\n}",
    "language": "javascript",
    "expectedVulnerabilities": [],
    "expectedFix": null
  }
]
